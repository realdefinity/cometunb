/* ——— Cards (Premium & Optimized) ——— */
.card {
  width: var(--card-w);
  height: var(--card-h);
  position: relative;
  margin-left: -44px; /* Stack overlap */
  perspective: 600px; /* Individual card perspective */
  z-index: 1;
  /* Initial State for dealing animation */
  transform: translate3d(50vw, -50vh, 200px) rotate(120deg); 
  opacity: 0;
  will-change: transform, opacity;
  transition: transform 0.5s var(--ease-out-expo), opacity 0.3s ease;
}

.card:first-child { margin-left: 0; }

.card.dealt {
  opacity: 1;
  /* Landing state: standard transform reset, but we keep the random rotation in JS via variable */
  transform: translate3d(0,0,0) rotate(var(--rot));
  z-index: auto;
}

/* The flipper container */
.card .inner {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Springy flip */
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Base shadow */
  border-radius: 12px;
  
  /* DEFAULT STATE: Back Visible (Rotated 180deg) */
  transform: rotateY(180deg);
}

/* Shadow depth that activates when dealt/hovered */
.card.dealt .inner {
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
}

/* State: Showing Face (flipped to 0deg) */
.card.flipped .inner {
  transform: rotateY(0deg);
}

/* Faces */
.card-face, .card-back {
  position: absolute;
  inset: 0;
  border-radius: 12px;
  backface-visibility: hidden; /* Hides the back when flipped */
  -webkit-backface-visibility: hidden;
  overflow: hidden;
}

/* Front Design (Visible at 0deg) */
.card-face {
  background: #fff;
  background-image: 
    linear-gradient(135deg, #ffffff 0%, #f3f4f6 100%);
  transform: rotateY(0deg);
  border: 1px solid rgba(0,0,0,0.1);
  /* Ensure face is 'above' back logic if browser fails backface-visibility */
  z-index: 2;
}

/* Back Design (Visible at 180deg) */
.card-back {
  background: #1a1a1a;
  transform: rotateY(180deg);
  border: 4px solid #fff;
  /* Premium Pattern */
  background-image: 
    radial-gradient(#c62828 15%, transparent 16%),
    radial-gradient(#c62828 15%, transparent 16%);
  background-size: 16px 16px;
  background-position: 0 0, 8px 8px;
  box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
  z-index: 1; 
}

/* Center Logo on Back */
.card-back::after {
  content: "♠";
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  font-size: 40px;
  color: #fff;
  opacity: 0.1;
  font-family: serif;
}

/* Corner Ranks */
.corner {
  position: absolute;
  top: 6px; left: 6px;
  display: flex;
  flex-direction: column;
  align-items: center;
  line-height: 1;
  font-weight: 700;
  font-size: 1.1rem;
}
.corner.bottom {
  top: auto; bottom: 6px;
  left: auto; right: 6px;
  transform: rotate(180deg);
}

.rank { font-family: 'JetBrains Mono', monospace; letter-spacing: -1px; }
.suit { font-size: 0.9em; margin-top: 2px; }

/* Colors */
.pip-red { color: #dc2626; }
.pip-black { color: #171717; }

/* Pip Grid (Middle) */
.pip-grid {
  position: absolute;
  inset: 30px 15px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(5, 1fr);
  place-items: center;
}
.pip { font-size: 1.4rem; line-height: 1; }
.pip.big { font-size: 3.5rem; }

/* Face Card Artwork Placeholder */
.face-card-art {
  position: absolute;
  inset: 20px;
  border: 1px solid rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 4rem;
  opacity: 0.15;
  color: inherit;
}

/* Bust Stamp */
.bust-stamp {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) rotate(-12deg) scale(0.5);
  border: 4px solid #ef4444;
  color: #ef4444;
  font-weight: 900;
  font-size: 1.8rem;
  text-transform: uppercase;
  padding: 4px 12px;
  border-radius: 8px;
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  pointer-events: none;
  background: rgba(255, 255, 255, 0.9);
  z-index: 10;
}
.card.busted .bust-stamp {
  opacity: 1;
  transform: translate(-50%, -50%) rotate(-12deg) scale(1);
}

/* Winner Pulse */
@keyframes winnerGlow {
  0%, 100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); }
  50% { box-shadow: 0 0 20px 4px rgba(234, 179, 8, 0.6); }
}
.card.winner .inner {
  animation: winnerGlow 2s infinite;
  border: 2px solid #eab308;
}

/* Optimization for lower end devices */
@media (prefers-reduced-motion: reduce) {
  .card, .card .inner { transition: none !important; animation: none !important; }
}
