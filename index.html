<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WikiFlow Redux</title>
    
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>

    <div class="blob-bg">
        <div class="blob b1"></div>
        <div class="blob b2"></div>
    </div>

    <div id="toast">Message</div>
    <div id="link-preview">
        <img id="lp-img" src="" alt="">
        <h4 id="lp-title">Title</h4>
        <p id="lp-desc">Description...</p>
    </div>

    <div id="target-tooltip">
        <h5>Target Insight</h5>
        <p id="tt-content">Loading definition...</p>
    </div>

    <div id="modal-overlay">
        <div id="custom-modal">
            <h3 id="modal-title">Confirm</h3>
            <p id="modal-desc" style="opacity:0.7; margin-bottom:30px;">Are you sure?</p>
            <div class="modal-actions" style="display:flex; gap:10px;">
                <button class="btn-modal" style="flex:1; padding:15px; border-radius:14px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:var(--text); cursor:pointer;" id="btn-cancel">Cancel</button>
                <button class="btn-modal" style="flex:1; padding:15px; border-radius:14px; background:var(--accent); border:none; color:white; font-weight:700; cursor:pointer;" id="btn-confirm">Confirm</button>
            </div>
        </div>
    </div>

<div class="screen" id="lobby">
    <div class="card lobby-glass">
        
        <div class="lobby-header-minimal">
            <div class="logo-minimal">
                <div class="logo-icon-small"></div>
                <span>WikiFlow</span>
            </div>
            <button class="icon-btn-ghost" onclick="showStats()">üìä</button>
        </div>

        <div class="lobby-body">
            
            <div class="segment-label">Game Mode</div>
            <div class="ios-segment">
                <div class="seg-opt active" id="m-std" onclick="setMode('standard')">Standard</div>
                <div class="seg-opt" id="m-sd" onclick="setMode('sudden_death')">Timed</div>
                <div class="seg-opt" id="m-gnt" onclick="setMode('gauntlet')">Gauntlet</div>
            </div>

            <div class="segment-row">
                <span class="segment-label-inline" id="setting-label">Difficulty</span>
                
                <div class="ios-segment small" id="diff-selector">
                    <input type="hidden" id="diff-value" value="medium">
                    <div class="seg-opt-sm" onclick="setDiff('easy', this)">Easy</div>
                    <div class="seg-opt-sm active" onclick="setDiff('medium', this)">Med</div>
                    <div class="seg-opt-sm" onclick="setDiff('hard', this)">Hard</div>
                </div>

                <div class="number-wrapper-clean" id="sd-config" style="display:none;">
                    <input type="number" id="sd-time-in" class="clean-num-input" value="30" min="10" max="300" readonly>
                    <div class="clean-arrows">
                        <div class="c-arrow up" onclick="adjustTime(10)">‚ñ≤</div>
                        <div class="c-arrow down" onclick="adjustTime(-10)">‚ñº</div>
                    </div>
                </div>
            </div>

            <div class="path-group">
                <div class="path-connector">
                    <div class="p-dot start"></div>
                    <div class="p-line"></div>
                    <div class="p-dot end"></div>
                </div>
                
                <div class="inputs-stack">
                    <input type="text" id="start-in" class="ios-input top" placeholder="Start Page" autocomplete="off">
                    <input type="text" id="end-in" class="ios-input bottom" placeholder="Target Page" autocomplete="off">
                    <div class="suggestions" id="sugg-start"></div>
                    <div class="suggestions" id="sugg-end" style="top: 100%;"></div>
                </div>
            </div>

        </div>

        <div class="lobby-footer-minimal">
            <button class="btn-text" onclick="randomize()">
                <span class="shuffle-icon">üîÄ</span> Shuffle
            </button>
            <button class="btn-ios-primary" onclick="initGame()">
                Start Race
            </button>
        </div>

    </div>
</div>

    <div class="screen hidden" id="win-screen">
        <canvas id="confetti-canvas"></canvas>
        <div class="card" style="z-index:201;">
            <h1 style="color:var(--success); font-size:3rem; margin-bottom:10px;">Victory!</h1>
            <p class="subtitle" id="win-sub">Destination Reached</p>

            <div id="galaxy-view">
                <canvas id="galaxy-canvas"></canvas>
                <div id="galaxy-overlay">Hover to view path</div>
            </div>

            <div style="font-size:4.5rem; font-weight:800; margin-bottom:15px; font-family:var(--font-ui); color:var(--text); text-shadow:0 10px 30px rgba(0,0,0,0.3);" id="win-time">0:00</div>
            <div style="display:flex; justify-content:center; gap:30px; margin-bottom:40px; opacity:0.9; font-size:1.1rem;">
                <span>Clicks: <b id="win-clicks" style="color:var(--accent);">0</b></span>
                <span>Penalties: <b id="win-penalties" style="color:var(--danger);">0s</b></span>
            </div>
            <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:20px; margin-bottom:25px; text-align:left; max-height:150px; overflow-y:auto; font-size:0.9rem; border:1px solid rgba(255,255,255,0.05);">
                <strong style="color:var(--accent); display:block; margin-bottom:5px; font-size:0.75rem; text-transform:uppercase;">Traversed Path</strong> 
                <span id="win-path" style="opacity:0.8; line-height:1.6;"></span>
            </div>
            <button class="btn-primary" onclick="returnToLobby()">Back to Lobby</button>
        </div>
    </div>

    <div class="screen hidden" id="stats-screen">
        <div class="card" style="max-width: 600px;">
            <h2 class="title" style="font-size: 2.5rem; margin-bottom: 20px;">Flow Profile</h2>
            <div class="stats-grid">
                <div class="stat-card"><div class="s-label">Games Won</div><div class="s-val" id="s-wins">0</div></div>
                <div class="stat-card"><div class="s-label">Win Rate</div><div class="s-val" id="s-rate">0%</div></div>
                <div class="stat-card"><div class="s-label">Current Streak</div><div class="s-val" id="s-streak">0</div></div>
                <div class="stat-card"><div class="s-label">Fastest Run</div><div class="s-val highlight" id="s-fast">--:--</div></div>
                <div class="stat-card"><div class="s-label">Avg. Clicks</div><div class="s-val" id="s-avg-clicks">0</div></div>
                <div class="stat-card"><div class="s-label">Total Time</div><div class="s-val" id="s-total-time">0h</div></div>
                <div class="stat-card wide"><div class="s-label">Total Links Surfed</div><div class="s-val" id="s-total-links" style="font-size: 2rem; color: var(--accent);">0</div></div>
                <div class="stat-card wide"><div class="s-label">Favorite Theme</div><div class="s-val" id="s-fav-theme" style="font-size: 1.2rem; text-transform: uppercase;">Classic</div></div>
            </div>
            <button class="btn-primary" onclick="closeStats()" style="margin-top: 30px;">Close</button>
        </div>
    </div>

    <div id="app">
        <header id="game-header" class="liquid-glass" style="border-radius:0 0 24px 24px; margin:0 20px;">
            <div class="logo" onclick="returnToLobby()">
                <div class="logo-icon"></div>
                WikiFlow
            </div>
            <div class="hud-right">
                <div class="stat target-hud" id="target-pill">
                    üéØ <span class="stat-text-truncate" id="target-display">...</span>
                </div>
                <div class="stat" id="timer-box">‚è± <span id="timer">00:00</span></div>
                <div class="stat">üëÜ <span id="click-count">0</span></div>
                <button class="quit-btn" onclick="askQuit()" title="Quit Game">‚úï</button>
            </div>
        </header>

        <div id="viewport">
            <div class="toolbar">
                <button class="tool-btn" onclick="askBacktrack()" id="btn-back">‚Ü© Back (Penalty)</button>
                <button class="tool-btn" onclick="setCheckpoint()" id="btn-set-cp">üö© Set Checkpoint</button>
                <button class="tool-btn" onclick="askLoadCheckpoint()" id="btn-load-cp" disabled>‚ö° Load CP</button>
            </div>

            <div id="gauntlet-bar">
                <span>Rounds:</span>
                <div id="g-dots-container" style="display:flex; gap:8px;"></div>
                <span style="margin-left:auto; opacity:0.6; font-size:0.75rem; font-weight:700; letter-spacing:1px;">GAUNTLET RUN</span>
            </div>
            
            <div id="wiki-container">
                <div class="article active" id="article-content"></div>
            </div>

            <div id="breadcrumbs"></div>

            <div class="loader" id="loader"><div class="spin"></div></div>
        </div>

        <div class="theme-fab" onclick="toggleThemes()">üé®</div>
        <div class="theme-panel" id="theme-panel"></div>
    </div>

<div class="lobby-header-minimal">
    <div class="logo-minimal">
        <div class="logo-icon-small"></div>
        <span>WikiFlow</span>
        <div class="rank-badge-small" id="lobby-rank">Lvl 1</div>
    </div>
    <button class="icon-btn-ghost" onclick="showStats()">üìä</button>
</div>

<div class="screen hidden" id="stats-screen">
    <div class="card" style="max-width: 600px;">
        <h2 class="title" style="font-size: 2.5rem; margin-bottom: 20px;">Flow Profile</h2>
        
        <div class="rank-card-large">
            <div class="rc-header">
                <span id="rank-title">NOVICE</span>
                <span id="rank-lvl">Lvl 1</span>
            </div>
            <div class="xp-track">
                <div class="xp-fill" id="xp-bar" style="width: 0%"></div>
            </div>
            <div class="xp-text">
                <span id="xp-current">0 XP</span> / <span id="xp-next">500 XP</span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card"><div class="s-label">Games Won</div><div class="s-val" id="s-wins">0</div></div>
            <div class="stat-card"><div class="s-label">Win Rate</div><div class="s-val" id="s-rate">0%</div></div>
            <div class="stat-card"><div class="s-label">Current Streak</div><div class="s-val" id="s-streak">0</div></div>
            <div class="stat-card"><div class="s-label">Fastest Run</div><div class="s-val highlight" id="s-fast">--:--</div></div>
            <div class="stat-card"><div class="s-label">Avg. Clicks</div><div class="s-val" id="s-avg-clicks">0</div></div>
            <div class="stat-card"><div class="s-label">Total Time</div><div class="s-val" id="s-total-time">0h</div></div>
            <div class="stat-card wide"><div class="s-label">Total Links Surfed</div><div class="s-val" id="s-total-links" style="font-size: 2rem; color: var(--accent);">0</div></div>
            <div class="stat-card wide"><div class="s-label">Favorite Theme</div><div class="s-val" id="s-fav-theme" style="font-size: 1.2rem; text-transform: uppercase;">Classic</div></div>
        </div>
        <button class="btn-primary" onclick="closeStats()" style="margin-top: 30px;">Close</button>
    </div>
</div>

<div id="viewport">
    <div class="toolbar">...</div> <div id="mini-map"></div>

    <div id="gauntlet-bar">...</div>
    <div id="wiki-container">...</div>
    ...
</div>

    <script src="js/state.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/main.js"></script>
</body>
</html>